DROP SCHEMA IF EXISTS ref CASCADE;
CREATE SCHEMA IF NOT EXISTS ref;
CREATE TABLE IF NOT EXISTS ref.Levels(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, Name text
, Const text
, PRIMARY KEY (ID) 
)  WITH (OIDS=FALSE, FILLFACTOR=90);

INSERT INTO ref.levels (ID, Name, Const)
VALUES 
(0, 'Проект', 'Project'),
(1, 'Эпика', 'Epic'),
(2, 'Требование', 'Requirement'),
(3, 'Проблема', 'Issue'),
(4, 'Требование', 'Requirement'),
(5, 'Функциональность', 'Feature'),
(6, 'Задача', 'Task');


CREATE TABLE IF NOT EXISTS ref.Categories(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, LevelID int
, Name text
, PRIMARY KEY (ID)
, FOREIGN KEY (LevelID) REFERENCES ref.Levels(ID) DEFERRABLE
)  WITH (OIDS=FALSE, FILLFACTOR=90);

CREATE TABLE IF NOT EXISTS ref.Statuses(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, LevelID int
, Name text
, PRIMARY KEY (ID)
, FOREIGN KEY (LevelID) REFERENCES ref.Levels(ID) DEFERRABLE
)  WITH (OIDS=FALSE, FILLFACTOR=90);

CREATE TABLE IF NOT EXISTS ref.Areas(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, LevelID int
, TeamID int
, Name text
, PRIMARY KEY (ID)
, FOREIGN KEY (LevelID) REFERENCES ref.Levels(ID) DEFERRABLE
, FOREIGN KEY (TeamID) REFERENCES cmn.Teams(ID) DEFERRABLE
)  WITH (OIDS=FALSE, FILLFACTOR=90);

CREATE TABLE IF NOT EXISTS ref.Iterations(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, LevelID int
, TeamID int
, ParentID int
, Name text
, PRIMARY KEY (ID)
, FOREIGN KEY (LevelID) REFERENCES ref.Levels(ID) DEFERRABLE
, FOREIGN KEY (TeamID) REFERENCES cmn.Teams(ID) DEFERRABLE
)  WITH (OIDS=FALSE, FILLFACTOR=90);