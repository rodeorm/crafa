
DROP SCHEMA IF EXISTS msg CASCADE;
CREATE SCHEMA msg;

CREATE TABLE IF NOT EXISTS msg.Types(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, Name TEXT UNIQUE
, Const TEXT UNIQUE
, PRIMARY KEY (ID) 
)  WITH (OIDS=FALSE, FILLFACTOR=90);

INSERT INTO msg.Types (ID, Name, Const)
VALUES 
(1, 'Подтверждение', 'Confirm'),
(2, 'Аутентификация', 'Auth'),
(3, 'Уведомление', 'Notify');

CREATE TABLE IF NOT EXISTS msg.Categories(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, Name TEXT UNIQUE
, Const TEXT UNIQUE
, PRIMARY KEY (ID) 
)  WITH (OIDS=FALSE, FILLFACTOR=90);
INSERT INTO msg.Categories (ID, Name, Const)
VALUES 
(1, 'Электронная почта', 'EMAIL'),
(2, 'Смс-сообщение', 'SMS');

CREATE TABLE IF NOT EXISTS msg.Messages(
ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY 
, Queued 		BOOL
, Used 			BOOL
, TypeID        INT
, CategoryID    INT
, UserID 		INT
, SendTime   	TIMESTAMP
, Text 		    TEXT
, Email 		TEXT	
, PRIMARY KEY (ID) 
, FOREIGN KEY (UserID) REFERENCES cmn.Users(ID) DEFERRABLE
, FOREIGN KEY (TypeID) REFERENCES msg.Types(ID) DEFERRABLE
)  WITH (OIDS=FALSE, FILLFACTOR=90);

